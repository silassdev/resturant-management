{
  "info": {
    "_postman_id": "5d8b5f40-restaurant-api-tests",
    "name": "Restaurant API - Automated Tests",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Admin: Login (set adminToken)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"username\": \"admin\",\n  \"password\": \"adminpass\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/admin/login",
          "host": ["{{base_url}}"],
          "path": ["api","admin","login"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('status 200 or 201', () => pm.response.to.have.status([200,201]));",
              "const json = pm.response.json();",
              "if (json?.token) {",
              "  pm.environment.set('adminToken', json.token);",
              "  console.log('adminToken set');",
              "} else {",
              "  // fallback to env ADMIN_TOKEN if login doesn't return a token",
              "  const fallback = pm.environment.get('ADMIN_TOKEN');",
              "  if (fallback) pm.environment.set('adminToken', fallback);",
              "}",
              "pm.test('has token or fallback', () => pm.expect(pm.environment.get('adminToken')).to.be.ok);"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },

    {
      "name": "Inventory: Create",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "x-admin-token", "value": "{{adminToken}}" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"Tomato\",\n  \"quantity\": 50,\n  \"unit\": \"pcs\",\n  \"lowStockThreshold\": 5\n}"
        },
        "url": { "raw": "{{base_url}}/api/inventory", "host": ["{{base_url}}"], "path":["api","inventory"] }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('status 201 or 200', () => pm.expect(pm.response.code).to.be.oneOf([200,201]));",
              "const json = pm.response.json();",
              "pm.expect(json).to.be.an('object');",
              "if (json._id) pm.environment.set('inventoryId', json._id);"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },

    {
      "name": "Inventory: List",
      "request": {
        "method": "GET",
        "header": [{ "key": "x-admin-token", "value": "{{adminToken}}" }],
        "url": { "raw": "{{base_url}}/api/inventory", "host":["{{base_url}}"], "path":["api","inventory"] }
      },
      "event": [
        {
          "listen":"test",
          "script": { "exec":[
            "pm.test('status 200', () => pm.response.to.have.status(200));",
            "const json = pm.response.json();",
            "pm.test('returns array', () => pm.expect(Array.isArray(json)).to.be.true);"
          ], "type":"text/javascript" }
        }
      ]
    },

    {
      "name": "Menu: Create",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "x-admin-token", "value": "{{adminToken}}" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"Margherita Pizza\",\n  \"description\": \"Classic\",\n  \"price\": 8.5,\n  \"ingredients\": [\"Dough\",\"Tomato\",\"Cheese\"],\n  \"prepTimeMinutes\": 15,\n  \"category\": \"Pizza\"\n}"
        },
        "url": { "raw": "{{base_url}}/api/menu", "host":["{{base_url}}"], "path":["api","menu"] }
      },
      "event":[{"listen":"test","script":{"exec":[
        "pm.test('status 201 or 200', () => pm.expect(pm.response.code).to.be.oneOf([200,201]));",
        "const json = pm.response.json();",
        "if (json._id) pm.environment.set('menuId', json._id);",
        "pm.test('body has name', () => pm.expect(json.name).to.eql('Margherita Pizza'));"
      ]}}]
    },

    {
      "name": "Menu: List",
      "request": {
        "method": "GET",
        "header": [{ "key": "x-admin-token", "value": "{{adminToken}}" }],
        "url": { "raw": "{{base_url}}/api/menu", "host":["{{base_url}}"], "path":["api","menu"] }
      },
      "event":[{"listen":"test","script":{"exec":[
        "pm.test('status 200', () => pm.response.to.have.status(200));",
        "const json = pm.response.json();",
        "pm.test('menu is array', () => pm.expect(Array.isArray(json)).to.be.true);"
      ]}}]
    },

    {
      "name": "Tables: Create",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }, { "key": "x-admin-token", "value": "{{adminToken}}" }],
        "body": { "mode": "raw", "raw": "{\n  \"number\": 1,\n  \"seats\": 4\n}" },
        "url": { "raw": "{{base_url}}/api/tables", "host":["{{base_url}}"], "path":["api","tables"] }
      },
      "event":[{"listen":"test","script":{"exec":[
        "pm.test('status created', () => pm.expect(pm.response.code).to.be.oneOf([200,201]));",
        "const json = pm.response.json(); if (json._id) pm.environment.set('tableId', json._id);"
      ]}}]
    },

    {
      "name": "Reservations: Create",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "body": { "mode": "raw", "raw": "{\n  \"customerName\": \"John Doe\",\n  \"phone\": \"+123456789\",\n  \"partySize\": 4,\n  \"reservedAt\": \"2025-12-10T19:00:00Z\",\n  \"tableId\": \"{{tableId}}\"\n}" },
        "url": { "raw": "{{base_url}}/api/reservations", "host":["{{base_url}}"], "path":["api","reservations"] }
      },
      "event":[{"listen":"test","script":{"exec":[
        "pm.test('status ok', () => pm.expect(pm.response.code).to.be.oneOf([200,201]));",
        "const json = pm.response.json(); if (json._id) pm.environment.set('reservationId', json._id);"
      ]}}]
    },

    {
      "name": "Orders: Create",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "body": { "mode": "raw", "raw": "{\n  \"tableId\": \"{{tableId}}\",\n  \"items\": [ { \"menuItemId\": \"{{menuId}}\", \"quantity\": 2 } ],\n  \"notes\": \"No onions\"\n}" },
        "url": { "raw": "{{base_url}}/api/orders", "host":["{{base_url}}"], "path":["api","orders"] }
      },
      "event":[{"listen":"test","script":{"exec":[
        "pm.test('status 201/200', () => pm.expect(pm.response.code).to.be.oneOf([200,201]));",
        "const json = pm.response.json(); if (json._id) pm.environment.set('orderId', json._id);",
        "pm.test('response has total', () => pm.expect(json).to.have.property('total'))"
      ]}}]
    },

    {
      "name": "Orders: List",
      "request": {
        "method": "GET",
        "header": [],
        "url": { "raw": "{{base_url}}/api/orders", "host":["{{base_url}}"], "path":["api","orders"] }
      },
      "event":[{"listen":"test","script":{"exec":[
        "pm.test('status 200', () => pm.response.to.have.status(200));",
        "const json = pm.response.json(); pm.test('orders array', () => pm.expect(Array.isArray(json)).to.be.true);"
      ]}}]
    },

    {
      "name": "Admin: Daily Sales Report",
      "request": {
        "method": "GET",
        "header": [{ "key": "x-admin-token", "value": "{{adminToken}}" }],
        "url": { "raw": "{{base_url}}/api/admin/reports/daily-sales?date=2025-12-10", "host":["{{base_url}}"], "path":["api","admin","reports","daily-sales"], "query":[{"key":"date","value":"2025-12-10"}] }
      },
      "event":[{"listen":"test","script":{"exec":[
        "pm.test('status 200', () => pm.response.to.have.status(200));",
        "const json = pm.response.json(); pm.test('has totalSales', () => pm.expect(json).to.have.property('totalSales'))"
      ]}}]
    }
  ]
}
